{
  "hash": "2b726df837243751b6cae2338634b401",
  "result": {
    "markdown": "---\ntitle: \"Simulating data for ANOVA similar to existing dataset for analysis\"\nauthor: Raju Rimal\ndate: \"2023-04-09\"\ndraft: true\ntags:\n  - Statistics\n  - ANOVA\n---\n\n\nSimulating data is used in education and research and has been an helpful tool\nfor testing, comparing and understanding concepts in practical and applied \nsetting.\n\n\n\n\n\n\n\nOften we Analysis of Variance (ANOVA) to analyze the variances to find if \ndifferent cases results in similar outcome and if the difference is significant. \nFollowing are some simple examples,\n\n- The effect of different diets on growth of fishes\n- Comparing the height of three different species of a plant\n- Type of flour used for baking a bread\n\nThese are some common examples where in some cases data are collected by setting \nup an experiment and in other cases they are collected through sampling. \nThis article tries to explain how the ANOVA analyze the variance and in what \nsituation are they significant throught both simulated and real data.\n\nConsider the following model with $i=3$ groups and $j=n$ observations,\n\n$$y_{ij} = \\mu + \\tau_i + \\varepsilon_{ij}, \\; i = 1, 2, 3 \n\\texttt{ and } j = 1, 2, \\ldots n$$\n\nhere, $\\tau_i$ is the effect corresponding to group $i$ and \n$\\varepsilon_{ij} \\sim \\mathrm{N}(0, \\sigma^2)$, the usual assumption of \nlinear model. Simulation example below describe it in details.\n\n# Simulation Example\nThis example simulates 3 datasets within each of them has 3 groups with\nwith their respective mean and standard deviation. These datasets tries to \nreplicate the `USArrest` dataset available in `dataset` package in R. The \nsimulation design is as follows,\n\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\nsim_design <- data.table(\n  Illitracy = factor(\n    rep(c(1, 2, 3), 3),\n    labels = c(\"high\", \"medium\", \"low\")\n  ),\n  Crime = factor(\n    rep(c(1, 2, 3), each = 3),\n    labels = c(\"Murder\", \"Assault\", \"Rape\")\n  ),\n  mean = c(11, 8, 5, 214, 190, 114, 23, 21, 19),\n  sd = c(3, 4, 3, 79, 82, 55, 8, 10, 10)\n)\n\nsim_design\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Illitracy   Crime mean sd\n1:      high  Murder   11  3\n2:    medium  Murder    8  4\n3:       low  Murder    5  3\n4:      high Assault  214 79\n5:    medium Assault  190 82\n6:       low Assault  114 55\n7:      high    Rape   23  8\n8:    medium    Rape   21 10\n9:       low    Rape   19 10\n```\n:::\n:::\n\n\nSince these data cannot contain negative values so instead of using `rnorm` \navailable in `stats` package, I will use `truncnorm` available in GitHub. There \nare other options as well which can be used such as: ...\n\nIf not installed, install the package as \n`remotes::install_github(\"olafmersmann/truncnorm\")` or \n`devtools::install_github(\"olafmersmann/truncnorm\")`.\n\nIn each group let's simulate 50 observations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnsim <- 50\n```\n:::\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\nsim_data <- copy(sim_design)[, map2_df(mean, sd, ~ data.table(\n  Rate = truncnorm::rtruncnorm(\n    n = nsim, a = 0, b = Inf, mean = .x, sd = .y\n  ) %>% round()\n)), by = .(Illitracy, Crime)]\n\nsim_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Illitracy  Crime Rate\n  1:      high Murder    7\n  2:      high Murder   11\n  3:      high Murder    9\n  4:      high Murder   12\n  5:      high Murder   15\n ---                      \n446:       low   Rape   11\n447:       low   Rape   18\n448:       low   Rape   23\n449:       low   Rape   11\n450:       low   Rape    4\n```\n:::\n:::\n\n\nLets use this simulated dataset for fitting Anova model with `Illitracy`\nas the factor (group) variable and `Rate` as the response variable \nseparately for each crime. Also make a density plot for both simulated and \nfitted values of the `Rate` variable.\n\n## R-codes {.tabset}\n\n### Model and plot data {.tab}\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\nmdl_fit <- sim_data[, .(\n  Fit = list(lm(Rate ~ Illitracy, data = .SD))\n), by = .(Crime)][, Summary := map(Fit, summary)]\nmdl_fit[, Anova := map(Fit, anova)]\nmdl_fit[, Tukey := map(Fit, aov) %>% map(TukeyHSD)]\n\nmdl_est <- mdl_fit[, map_df(\n  .x = Summary,\n  .f = broom::tidy,\n  conf.int = TRUE\n), by = .(Crime)]\n\nmdl_fit_df <- mdl_fit[, map_df(\n  .x = Fit,\n  .f = broom::augment\n), by = .(Crime)]\n\neff_df <- mdl_fit[, map_df(Fit, function(.fit) {\n  effects::Effect(\"Illitracy\", .fit) %>%\n    as.data.table()\n}), by = \"Crime\"]\n\ntky_df <- mdl_fit[, modify_depth(Tukey, 1, \"Illitracy\") %>%\n  as.data.table(keep.rownames = \"terms\"), by = \"Crime\"]\n```\n:::\n\n\n### Density plot {.tab}\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\ndensity_plts <- split(sim_data, by = \"Crime\") %>%\n  imap(function(dta, name) {\n    ggplot(dta, aes(Rate, color = Illitracy)) +\n      geom_density(aes(linetype = \"Simulated\")) +\n      geom_density(\n        aes(linetype = \"Fitted\", x = .fitted),\n        data = mdl_fit_df[Crime == name]\n      ) +\n      geom_rug(\n        data = eff_df[Crime == name],\n        aes(x = fit)\n      ) +\n      scale_linetype_manual(\n        breaks = c(\"Simulated\", \"Fitted\"),\n        values = c(\"solid\", \"dashed\")\n      ) +\n      scale_color_brewer(palette = \"Set1\") +\n      theme(legend.position = \"bottom\") +\n      labs(\n        x = name,\n        y = \"Density\",\n        linetype = NULL\n      )\n  })\n```\n:::\n\n\n### Box plot {.tab}\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\nbox_plts <- split(mdl_fit_df, by = \"Crime\") %>%\n  imap(function(dta, name) {\n    ggplot(dta, aes(Rate, Illitracy)) +\n      geom_boxplot(\n        notch = TRUE, \n        color = \"grey\",\n        outlier.colour = \"grey\"\n      ) +\n      geom_point(\n        position = position_jitter(height = 0.25),\n        color = \"grey\",\n      ) +\n      geom_pointrange(\n        aes(\n          color = \"Estimated\",\n          xmin = lower,\n          xmax = upper,\n          x = fit\n        ),\n        data = eff_df[Crime == name]\n      ) +\n      geom_point(\n        aes(color = \"True\", x = mean),\n        data = sim_design[Crime == name]\n      ) +\n      scale_color_brewer(\n        name = \"Mean\",\n        palette = \"Set1\"\n      ) +\n      theme(\n        legend.position = \"bottom\"\n      )\n  })\n```\n:::\n\n\n### Posthoc plot {.tab}\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\ntky_plts <- split(tky_df, by = \"Crime\") %>%\n  imap(function(dta, name) {\n    ggplot(dta, aes(diff, terms)) +\n      geom_pointrange(\n        aes(xmin = lwr, xmax = upr, x = diff),\n        shape = 21,\n        fill = \"whitesmoke\"\n      ) +\n      geom_vline(\n        xintercept = 0,\n        linetype = \"dashed\",\n        color = \"royalblue\"\n      ) +\n      scale_color_brewer(\n        name = \"Mean\",\n        palette = \"Set1\"\n      ) +\n      labs(\n        y = \"Illitracy\",\n        x = \"Effect difference\",\n        title = \"Pairwise comparison of levels of illitracy\"\n      ) +\n      expand_limits(x = 0)\n  })\n```\n:::\n\n\n## Analysis {.tabset}\n\n### Murder {.tab .tabset}\n\n#### Distribution {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.svg){width=100%}\n:::\n:::\n\n\n#### Fit {.tab}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illitracy, data = .SD)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n -8.44  -2.31   0.08   1.95   7.56 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)      10.9200     0.4247  25.713  < 2e-16 ***\nIllitracymedium  -2.4800     0.6006  -4.129 6.08e-05 ***\nIllitracylow     -6.0000     0.6006  -9.990  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.003 on 147 degrees of freedom\nMultiple R-squared:  0.4068,\tAdjusted R-squared:  0.3987 \nF-statistic:  50.4 on 2 and 147 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n#### Effects {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.svg){width=100%}\n:::\n:::\n\n\n#### Post-hoc {.tab}\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.svg){width=100%}\n:::\n:::\n\n\n### Assault {.tab .tabset}\n\n#### Distribution {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.svg){width=100%}\n:::\n:::\n\n\nThe distribution of the high and medium illitracy is similar as contrast to low \nillitracy group in the case of assult.\n\n#### Fit {.tab}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illitracy, data = .SD)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-158.32  -42.22   -3.11   38.74  221.68 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       208.32       9.64  21.609  < 2e-16 ***\nIllitracymedium    -5.00      13.63  -0.367    0.714    \nIllitracylow      -95.42      13.63  -6.999 8.51e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 68.17 on 147 degrees of freedom\nMultiple R-squared:  0.2969,\tAdjusted R-squared:  0.2873 \nF-statistic: 31.03 on 2 and 147 DF,  p-value: 5.709e-12\n```\n:::\n:::\n\n\n#### Effects {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.svg){width=100%}\n:::\n:::\n\n\n#### Post-hoc {.tab}\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.svg){width=100%}\n:::\n:::\n\n\n\n### Rape {.tab .tabset}\n\n#### Distribution {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.svg){width=100%}\n:::\n:::\n\n\n#### Fit {.tab}\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illitracy, data = .SD)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n-20.10  -6.10  -0.11   5.56  20.90 \n\nCoefficients:\n                Estimate Std. Error t value Pr(>|t|)    \n(Intercept)       22.440      1.219  18.403  < 2e-16 ***\nIllitracymedium   -1.340      1.724  -0.777  0.43837    \nIllitracylow      -5.320      1.724  -3.085  0.00243 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 8.622 on 147 degrees of freedom\nMultiple R-squared:  0.06547,\tAdjusted R-squared:  0.05276 \nF-statistic:  5.15 on 2 and 147 DF,  p-value: 0.006894\n```\n:::\n:::\n\n\n#### Effects {.tab}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.svg){width=100%}\n:::\n:::\n\n\n#### Post-hoc {.tab}\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.svg){width=100%}\n:::\n:::\n\n\n# Real Data Example\n\n\n::: {.cell}\n\n```{.r .bg-info .cell-code .folded .cell-code}\narrest <- merge.data.table(\n  as.data.table(USArrests, keep.rownames = \"States\"),\n  as.data.table(\n    state.x77[, \"Illiteracy\", drop = FALSE],\n    keep.rownames = \"States\"\n  ),\n  by = \"States\"\n)\narrest[, UrbanPop := NULL]\narrest <- arrest[, lapply(.SD, as.numeric), by = \"States\"]\n\narrest[, Illiteracy := cut.default(\n  Illiteracy,\n  breaks = quantile(Illiteracy, c(0, 1/3, 2/3, 1)),\n  labels = c(\"low\", \"medium\", \"high\"),\n  include.lowest = TRUE\n)]\n\narrest <- melt.data.table(\n  data = arrest[, lapply(.SD, as.numeric), \n    by = .(States, Illiteracy)],\n  id.vars = c(\"States\", \"Illiteracy\"),\n  value.name = \"Rate\",\n  variable.name = \"Crime\"\n)\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n       States Illiteracy  Crime Rate\n1:    Alabama       high Murder 13.2\n2:     Alaska       high Murder 10.0\n3:    Arizona       high Murder  8.1\n4:   Arkansas       high Murder  8.8\n5: California     medium Murder  9.0\n6:   Colorado        low Murder  7.9\n```\n:::\n:::\n\n\n## Results {.tabset}\n\n\n::: {.cell}\n\n:::\n\n\n#### Distribution {.tab}\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.svg){width=100%}\n:::\n:::\n\n\n#### Fit {.tab .tabset}\n\n##### Murder {.tab}\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illiteracy, data = .SD)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-6.7067 -2.3000 -0.3059  1.7882  7.8933 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        4.6000     0.7856   5.855 4.46e-07 ***\nIlliteracymedium   2.9067     1.1653   2.494   0.0162 *  \nIlliteracyhigh     6.8118     1.1273   6.043 2.32e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 3.333 on 47 degrees of freedom\nMultiple R-squared:  0.4382,\tAdjusted R-squared:  0.4143 \nF-statistic: 18.33 on 2 and 47 DF,  p-value: 1.302e-06\n```\n:::\n:::\n\n\n##### Assult {.tab}\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illiteracy, data = .SD)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-168.000  -41.792   -4.083   47.958  145.333 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        114.17      17.04   6.702 2.32e-08 ***\nIlliteracymedium    75.50      25.27   2.988 0.004453 ** \nIlliteracyhigh      99.83      24.44   4.084 0.000171 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 72.28 on 47 degrees of freedom\nMultiple R-squared:  0.2786,\tAdjusted R-squared:  0.2479 \nF-statistic: 9.074 on 2 and 47 DF,  p-value: 0.0004653\n```\n:::\n:::\n\n\n##### Rape {.tab}\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Rate ~ Illiteracy, data = .SD)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-14.133  -6.259  -2.357   3.766  26.939 \n\nCoefficients:\n                 Estimate Std. Error t value Pr(>|t|)    \n(Intercept)        19.061      2.211   8.620 3.08e-11 ***\nIlliteracymedium    2.372      3.280   0.723    0.473    \nIlliteracyhigh      4.292      3.173   1.353    0.183    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 9.382 on 47 degrees of freedom\nMultiple R-squared:  0.03766,\tAdjusted R-squared:  -0.003286 \nF-statistic: 0.9198 on 2 and 47 DF,  p-value: 0.4057\n```\n:::\n:::\n\n\n#### Effects {.tab}\n\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-28-1.svg){width=100%}\n:::\n:::\n\n\n#### Post-hoc {.tab}\n\n::: {.cell fig.asp='0.5'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-29-1.svg){width=100%}\n:::\n:::\n\n\n## Discussion\n\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{"title":"Scatter plot with multiple group","markdown":{"yaml":{"title":"Scatter plot with multiple group","slug":"scatter-plot-multple-group","author":"Raju Rimal","date":"2016-01-12","tags":["Statistics","Regression","R","Visualization"]},"headingText":"Plots","headingAttr":{"id":"","classes":["tabset"],"keyvalue":[]},"containsRefs":false,"markdown":"\n\n```{r, include = FALSE}\nknitr::opts_chunk$set(\n  comment = NA, \n  dev = \"svg\",\n  fig.align = 'center', \n  out.width = \"100%\",\n  warning = FALSE, \n  message = FALSE\n)\n```\n\n\nIn many situations, it becomes essential to have a plot with multiple categories. For example, colour the scatter plot according to gender and have two different regression line for each of them.\n\nLets scatter the some points using data from `mtcars`, available default in R. Continuing the discussing from this post, where we had plotted mile per gallon (`mpg`) vs displacement (`disp`). Here we will create a separate regression line and colour the points accordingly based on number of cylinder (`cyl`) in the cars. In this article also, I will use there plotting system -- base graphics, lattice plot and ggplot2. \n\nFirst, lets fit our linear model with number of cylinder as a categorical variable.\n\n```{r  fit-model}\nmtcars <- within(mtcars, cyl <- as.factor(cyl))\nmdl    <- lm(mpg ~ disp * cyl, data = mtcars)\nsumry  <- summary(mdl)\nsumry\n```\n\nLets create a (intercept, slope) pair for each level of `cyl` and create separate equation for them.\n\n```{r create-eqn}\ncf  <- round(coef(mdl), 3)\neq1 <- c(cf[1], cf[2])\neq2 <- c(cf[1] + cf[3], cf[2] + cf[5])\neq3 <- c(cf[1] + cf[4], cf[2] + cf[6])\neq.fn <- function(eq) {\n  paste0(\"mpg = \", eq[1],\n         ifelse(eq[2] < 0, \" - \", \" + \"),\n         abs(eq[2]), \" disp\")\n}\neqn <- sapply(list(eq1, eq2, eq3), eq.fn)\nrsq.info <- c(paste0(\"R^2: \", round(sumry[[\"r.squared\"]], 2)),\n              paste0(\"adj. R^2: \", round(sumry[[\"adj.r.squared\"]], 2)))\n```\n\n\n::: panel-tabset\n\n### Base Graphics {.tab}\n```{r base-plot}\nwith(mtcars, {\n  car::scatterplot(disp, mpg, groups = cyl, smooth = F,\n                   xlab = \"Displacement\",\n                   ylab = \"Mile per Gallon\",\n                   main = \"Mile per gallon vs displacement\")\n})\nop <- par(family = \"monospace\")\nlegend(\"topright\", text.col = 1:3, col = 1:3, box.lty = 0,\n       lty = 1, lwd = 1, legend = eqn)\nlegend(\"bottomleft\", legend = rsq.info)\npar(op)\n```\n\n### Lattice Plot {.tab}\n```{r lattice-graphics}\nlibrary(lattice)\nlm.panel <- function(x, y, ...) {\n  panel.xyplot(x, y, ...)\n  panel.abline(eq1, col = 1, lwd = 2, lty = 2)\n  panel.abline(eq2, col = 2, lwd = 2, lty = 2)\n  panel.abline(eq3, col = 3, lwd = 2, lty = 2)\n  panel.text(max(x), max(y), pos = 2,\n             fontfamily = \"monospace\",\n             label = paste(eqn, collapse = \"\\n\"))\n  panel.text(min(x), min(y), pos = 4,\n             fontfamily = \"monospace\",\n             label = paste(rsq.info, collapse = \"\\n\"))\n}\nxyplot(mpg ~ disp, data = mtcars, groups = cyl,\n       auto.key = list(columns = 3, cex = 0.8,\n                       title = \"Cylinder\"),\n       col = 1:3, xlab = \"Displacement\",\n       ylab = \"Mile per gallon\",\n       panel = lm.panel)\n```\n\n### ggplot2 {.tab}\n```{r ggplot}\nlibrary(ggplot2)\n## Equation table for displaying them on the plot\neqn.df <- with(mtcars, {\n  data.frame(\n    cyl  = sort(unique(cyl)),\n    mpg  = max(mpg) - c(1:3),\n    disp = max(disp), eqn = eqn\n  )\n})\nggplot(mtcars, aes(disp, mpg, color = cyl)) +\n  geom_point() +\n  theme_bw(base_size = 14) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  geom_text(data = eqn.df, aes(label = eqn),\n            hjust = 1, family = \"mono\") +\n  annotate(geom = \"text\",\n           x = min(mtcars$disp), y = min(mtcars$mpg),\n           family = \"mono\", hjust = 0,\n           label = paste0(rsq.info, collapse = \"\\n\"))\n```\n\n:::\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":true,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["lightbox"],"toc":true,"output-file":"index.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.335","fontsize":"1.2em","linestretch":1.75,"theme":{"light":["default","../../../light.scss","../../../styles.scss"],"dark":["default","../../../dark.scss","../../../styles.scss"]},"title-block-banner":false,"title":"Scatter plot with multiple group","slug":"scatter-plot-multple-group","author":"Raju Rimal","date":"2016-01-12","tags":["Statistics","Regression","R","Visualization"]},"extensions":{"book":{"multiFile":true}}}}}